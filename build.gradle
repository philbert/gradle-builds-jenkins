buildscript {
  repositories {
    maven {
      url "https://plugins.gradle.org/m2/"
    }
    maven {
      url "http://maven.jenkins-ci.org:8081/content/repositories/releases/"
    }
  }
  dependencies {
    classpath "com.terrafolio:gradle-jenkins-plugin:1.3.2"
  }
}

apply plugin: "com.terrafolio.jenkins"

jenkins {
    // server definitions
    servers {
        demo {
            url 'http://88.80.174.222:8080/'
            secure true
            username "phil"
            password "phil"
        }
    }

    defaultServer servers.demo

    dsl {
        workflowJob('example') {
            description "Job created by gradle-jenkins-plugin"
            definition {
                cps {
                    // this doesn't work the way I expect either :(
                    script(streamFileFromWorkspace('Jenkinsfile'))
                }
// This fails because cpsScm is introduced in jenkins-job-dsl 1.44
//                cpsScm {
//                    scm {
//                        git('https://github.com/jenkinsci/job-dsl-plugin.git', 'master')
//                        scriptPath('Jenkinsfile')
//                    }
//                }
            }
        }
    }
}

